<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner Code-Barres</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        #scanner-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
        }
        #scanner-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #product-info {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Scanner Code-Barres</h1>

    <!-- Conteneur de la caméra pour scanner le code-barres -->
    <div id="scanner-container">
        <!-- Le scanner de code-barres sera affiché ici -->
    </div>

    <div id="product-info">
        <h3>Information du produit :</h3>
        <div id="product-name">Nom du produit : </div>
        <div id="product-price">Prix : </div>
    </div>

    <script>
        // Base de données locale des produits simulée
        const productsDatabase = {
            "1234567890": { name: "Pommes", price: 2.5 },
            "0987654321": { name: "Bananes", price: 1.8 },
            "1357912468": { name: "Oranges", price: 3.0 },
            "2468135790": { name: "Pâtes", price: 1.2 }
        };

        // Initialiser Quagga pour le scanner de code-barres
        function initScanner() {
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-container'),  // L'élément où afficher le flux vidéo
                    constraints: {
                        facingMode: "environment"
                    }
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader", "upc_e_reader"]
                }
            }, function(err) {
                if (err) {
                    console.log("Erreur lors de l'initialisation du scanner :", err);
                    return;
                }
                console.log("Scanner prêt");
                Quagga.start();
            });

            // Callback lorsqu'un code-barres est détecté
            Quagga.onDetected(function(data) {
                const code = data.codeResult.code;  // Code-barres scanné

                console.log("Code-barres scanné : ", code);
                
                // Chercher le produit dans la base de données locale
                if (productsDatabase[code]) {
                    const product = productsDatabase[code];
                    document.getElementById('product-name').innerHTML = "Nom du produit : " + product.name;
                    document.getElementById('product-price').innerHTML = "Prix : " + product.price + "€";
                } else {
                    document.getElementById('product-name').innerHTML = "Produit non trouvé.";
                    document.getElementById('product-price').innerHTML = "";
                }
            });
        }

        // Initialiser le scanner dès que la page est chargée
        window.onload = initScanner;
    </script>

</body>
</html>